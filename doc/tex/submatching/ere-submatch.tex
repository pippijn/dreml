\section{Extended regular expression submatching}
\label{ere-submatch}

The definition of partial derivatives from \cite{pd-pat} has been combined
with the extended regular expression operators as defined in \cite{pd-ere}.
The regular expression syntax from Sulzmann and Lu is amended with additional
boolean operators for extended regular expressions.

\begin{defn}
   \label{defn-syn}
   Syntax of extended patterns and regular expressions.

   Words:

   \begin{tabular}{lrll}
      $w$	& $::=$	& $\varepsilon$		& Empty word	\\
		& $|$	& $l \in \Sigma$	& Letters	\\
		& $|$	& $lw$			& Concatenation	\\
   \end{tabular}

   Extended regular expressions:

   \begin{tabular}{lrll}
      $r$	& $::=$	& $r+r$				& Choice		\\
		& $|$	& $(r,r)$			& Concatenation		\\
		& $|$	& $r_e \cap r_e$		& Intersection		\\
        	& $|$	& $\neg r_e$			& Negation		\\
        	& $|$	& $r_e^n$			& Repetition		\\
		& $|$	& $r^*$				& Kleene star		\\
		& $|$	& $\varepsilon$			& Empty word		\\
		& $|$	& $\phi$			& Empty language	\\
		& $|$	& $l \in Sigma$			& Letters		\\
   \end{tabular}

   Extended patterns:

   \begin{tabular}{lrll}
      $p$	& $::=$	& $(x:r)$			& Variables Base	\\
		& $|$	& $(x:p)$			& Variables Group	\\
		& $|$	& $p+p$				& Choice		\\
		& $|$	& $(p,p)$			& Concatenation		\\
		& $|$	& $p_e \cap p_e$		& Intersection		\\
        	& $|$	& $p_e^n$			& Repetition		\\
		& $|$	& $p^*$				& Kleene star		\\
   \end{tabular}
\end{defn}


Pattern and expression repetition in the form $r^n$ is essentially the same as
concatenating the same pattern or expression $n$ times. However, in a pattern,
this would cause variable binding clashes. For example, when expanding
$(x:a)^2$ to $(x:a)(x:a)$, the variable $a$ appears twice. Since this is not
allowed in patterns, the definition of partial derivatives incorporates direct
support for this form.

The partial derivative of a negated pattern is not defined, because it cannot
be sensibly decided which part of a non-match should be assigned to which
pattern variable. The assignment is decidable if and only if every sub-pattern
always consumes the complete input, but for these patterns, their negation can
be pushed into the pattern. For variables base, $\neg(x:p) \equiv (x:\neg p)$,
and for pattern intersection, by De Morgan's law $\neg((x:p_1) \cap (y:p_2))
\equiv (x:\neg p_1) + (y:\neg p_2)$. Variable assignment can not be decided
for other patterns. E.g. when matching the string ``ccc'' with the pattern
$\neg((x:a)(y:b))$, it is impossible to decide which part of the string should
be assigned to $x$ and which to $y$. Therefore, we represent a subset of
pattern negations in terms of a negation normal form transformation that must
be applied before beginning the pattern match.

\needspace{4cm}

\begin{defn}
   \label{defn-negnorm}
   Negation normal form.

   \begin{tabular}{lll}
      $\negnorm(\neg(x : r))$		& $=$	& $(x : \neg r)$					\\
      $\negnorm(\neg(x : p))$		& $=$	& $(x : \negnorm(\neg p)$				\\
      Double negation:			&	&							\\
      $\negnorm(\neg(\neg p))$		& $=$	& $\negnorm(p)$						\\
      De Morgan's laws:			&	&							\\
      $\negnorm(\neg(p_1 \cap p_2))$	& $=$	& $(\negnorm(\neg p_1) + \negnorm(\neg p_2)$		\\
      $\negnorm(\neg(p_1 + p_2))$	& $=$	& $(\negnorm(\neg p_1) \cap \negnorm(\neg p_2)$		\\
      Distributive laws:		&	&							\\
      $\negnorm(x : p)$			& $=$	& $(x : \negnorm p)$					\\
      $\negnorm(p_1 + p_2)$		& $=$	& $\negnorm(p_1) + \negnorm(p_2)$			\\
      $\negnorm(p_1 \cap p_2)$		& $=$	& $\negnorm(p_1) \cap \negnorm(p_2)$			\\
      $\negnorm(p_1, p_2)$		& $=$	& $(\negnorm(p_1), \negnorm(p_2))$			\\
      $\negnorm(p_1^*)$			& $=$	& $\negnorm(p_1)^*$					\\
      $\negnorm(p_1^n)$			& $=$	& $\negnorm(p_1)^n$					\\
      Trivial atomic pattern:		&	&							\\
      $\negnorm(x : r)$			& $=$	& $(x : r)$						\\
   \end{tabular}
\end{defn}

We do not define negation of patterns containing concatenation and iteration,
since there is no sensible way to assign pattern variables to submatches.

In the remainder of this paper, we will use the term ``regular expression''
for extended regular expressions, and refer to their instances as $r$ instead
of $r_e$.  Analogously, the term ``pattern'' is used for ``extended pattern''
and $p$ is an instance.

\begin{defn}
   \label{defn-lang}
   Matching environments and language of regular expressions.

   Environments:

   \begin{tabular}{lrll}
      $\Gamma$	& $::=$	& $\{x:w\}$			& Variable binding	\\
		& $|$	& $\Gamma \uplus \Gamma$	& Ordered multi-set of
							  variable bindings	\\
   \end{tabular}

   Language:

   \begin{tabular}{lll}
      $L(r_1 + r_2)$	& $=$	& $L(r_1) \cup L(r_2)$					\\
      $L((r_1, r_2))$	& $=$	& $\{ w_1w_2 | w_1 \in L(r_1), w_2 \in L(r_2) \}$	\\
      $L(r_1 \cap r_2)$	& $=$	& $L(r_1) \cap L(r_2)$					\\
      $L(\neg r)$	& $=$	& $\{\Sigma^*\} \setminus L(r)$				\\
      $L(r^*)$		& $=$	&
         $\{\varepsilon\} \cup \{ w_1 \dots w_n | i
         \in \{ 1, \dots, n \}, w_i \in L(r) \}$	\\
      $L(r^n)$		& $=$	&
         $\{ w_1 \dots w_n | w_n \in L(r) \}$	\\
      $L(l)$		& $=$	& $\{l\}$						\\
      $L(\varepsilon)$	& $=$	& $\{\varepsilon\}$					\\
      $L(\phi)$		& $=$	& $\emptyset$						\\
   \end{tabular}
\end{defn}

% TODO: prove L(r^n)

The variable environments are the same as in \cite{pd-pat}, the language
definition has been extended with the definitions from \cite{pd-ere}.
Juxtaposition of terms is used interchangably with the explicit pair syntax
for concatenation, following from the language definition as set product of
the languages of the concatenated terms.


% vim:tw=78
