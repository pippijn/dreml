\documentclass[12pt,a4paper,headsepline,oneside]{scrbook}
\usepackage{framed}
\usepackage[utf8x]{inputenc}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{enumitem}
\usepackage{needspace}
\usepackage[implicit,naturalnames]{hyperref}
\usepackage{color}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage{amsfonts}
\usepackage{textcomp}
\usepackage[a4paper,left=3cm,right=3cm,top=3.5cm,bottom=2cm]{geometry}
\usepackage{tikz}
%\usepackage{setspace}
%\usepackage[scaled=.8]{DejaVuSansMono}

% Listings settings
\lstset{language=Caml}
\lstset{defaultdialect=[Objective]Caml}
%\lstset{basicstyle=\footnotesize,breaklines=true}

\definecolor{dark-red}  {rgb}{0.60, 0.15, 0.15}
\definecolor{dark-green}{rgb}{0.15, 0.40, 0.15}
\definecolor{dark-blue} {rgb}{0.15, 0.15, 0.60}

\hypersetup{
   colorlinks,
   urlcolor=dark-green,
   linkcolor=dark-blue,
   citecolor=dark-red,
}

% Line distance
%\renewcommand{\baselinestretch}{1.25}\normalsize
%\onehalfspacing

% Colours
\newcommand{\optcolor}[2]{\textcolor[rgb]{#1}{#2}}

% Images
\newcommand{\img}[3]{
   \begin{figure}
      \centering
      \includegraphics[width=#2]{img/#1}
      \caption{#3}
      \label{img-#1}
   \end{figure}
}

% Theorems
\theoremstyle{definition}

\declaretheorem[name=\optcolor{1,0,0}{Theorem}]{thmbase}
\declaretheorem[name=\optcolor{1,0,0}{Lemma},sibling=thmbase]{lembase}
\declaretheorem[name=\optcolor{0,0,1}{Definition},sibling=thmbase]{defnbase}
\declaretheorem[name=\optcolor{0,0.5,0}{Example}]{eg}
\declaretheorem[name=Remark]{rem}

\newlength{\topsepbackup}

\newcommand{\newboxenv}[4]
  {\newenvironment{#1}
    {
      \pagebreak[2]
      \ifx\bw\relax
        \definecolor{shadecolor}{gray}{#3}
      \else
        \definecolor{shadecolor}{rgb}{#4}
      \fi
      \setlength{\topsepbackup}{\topsep}
      \setlength{\topsep}{0pt}
      \begin{shaded}
      \begin{#2}
    }{
      \end{#2}
      \end{shaded}
      \setlength{\topsep}{\topsepbackup}
    }
  }

\newboxenv{thm}{thmbase}{0.9}{0.97,0.97,0.97}
\newboxenv{lem}{lembase}{0.9}{0.97,0.97,0.97}
\newboxenv{defn}{defnbase}{0.91}{0.97,0.97,0.97}
%\newboxenv{eg}{egbase}{0.91}{1,1,1}
%\newboxenv{rem}{rembase}{0.91}{1,1,1}

\parskip=4pt
\parindent=0pt

\input{tex/macros}

\begin{document}

\tableofcontents

\input{tex/syntax}
\input{tex/intro}
\input{tex/background}
\input{tex/submatching}
\input{tex/implementation}
\input{tex/results}
\input{tex/discussion}
\input{tex/conclusion}

\listoftheorems[ignoreall,show={defnbase,lembase}]
\listoffigures

\bibliographystyle{alpha}
\bibliography{dreml}

\end{document}
